<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Only Pets Client</title>
</head>
<body>

    <h2>Submit Post</h2>
    <form action="http://localhost:3001/post/" method="post" enctype="multipart/form-data">
        <input type="file" name="postImage" />
        <input type="text" name="description"/>
        <input type="text" name="userId" value="1"/>
        <button type="submit" >Submit</button>
    </form>

    <h2>Update Post</h2>
    <form  id="update-form">
        <input type="file" name="postImage" id="update-file"/>
        <input type="text" name="description" id="update-desc"/>
        <input type="text" name="userId" value="1" id="update-user"/>
        <button onclick=sendData() type="submit">Submit</button>
    </form>

    <h2>Get Posts</h2>
    <div>
        <button onclick=getPhoto()>Get by Id</button>
        <input type="text" id="postId" />
    </div>
    
    <div>
        <button onclick=getPhotoByPet()>Get by Pet Id</button>
        <input type="text" id="petId" />
    </div>

    <div>
        <button onclick=getAll()>Get All Pets!</button>
    </div>

    <img src="" id="test-img">
    <div id="group-img"></div>

    <script>
        const form = document.getElementById("update-form");
        form.addEventListener('submit', sendData);

        function sendData(e) {
            e.preventDefault();

            const formData = new FormData();
    
            const file = document.getElementById('update-file').files[0];
            const desc = document.getElementById('update-desc').value;
            const userId = document.getElementById('update-user').value;

            const url = `http://localhost:3001/post/1`

            formData['postImage'] = file;
            formData['description'] = desc;
            formData['userId'] = userId;
            
            console.log(formData);

            var request = new XMLHttpRequest();
            request.open('POST', 'https://localhost:3030/fs/profile-photo');
            request.onload = function (e) {
                if (request.status == 200) {
                    console.log('Upload success: ', request.response);
                } else {
                    console.log('upload error: ', e);
                }
            };

            request.send(formData);        

        }

        function getPhoto(){
            const id = document.getElementById('postId').value
            const image = document.getElementById('test-img')

            if (id) {
                fetch(`http://localhost:3001/post/${id}`)
                    .then(response => response.json())
                    .then(json => image.src = `data:${json.photoType};base64, ${json.photo}`)
                    .catch(err => console.error(err));
            }

        }

        function getPhotoByPet() {
                const id = document.getElementById('petId').value
                const group = document.getElementById('group-img')
                if (id) {
                    fetch(`http://localhost:3001/post/byPet/${id}`)
                        .then(response => response.json())
                        .then(json => {
                            while(group.firstChild) group.removeChild(group.firstChild);
                            json.map(photo => {
                                const pic = document.createElement('img');
                                pic.src = `data:${photo.photoType};base64, ${photo.photo}`;
                                group.appendChild(pic)
                            })
                        })
                        .catch(err => console.error(err));
                }

            }

            function getAll() {
                    const group = document.getElementById('group-img')

                    fetch(`http://localhost:3001/post/`)
                        .then(response => response.json())
                        .then(json => {
                            while (group.firstChild) group.removeChild(group.firstChild);
                            json.map(photo => {
                                const pic = document.createElement('img');
                                pic.src = `data:${photo.photoType};base64, ${photo.photo}`;
                                group.appendChild(pic)
                            })
                        })
                        .catch(err => console.error(err));
                }
    </script>
</body>
</html>